{
  "hash": "880134bf2cb69fa4e20e951216796575",
  "result": {
    "markdown": "---\ntitle: TidyTuesday - Transit Costs\ndate: '2021-01-11'\ncategories:\n  - TidyTuesday\n  - Visualization\n---\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<blockquote class=\"twitter-tweet\" data-width=\"550\" data-lang=\"en\" data-dnt=\"true\" data-theme=\"light\"><p lang=\"en\" dir=\"ltr\">Comparing Indian rail projects to our neighbour China, I find that, on average, Indian lines have a higher number of stations and longer lines than our Chinese counterparts. <br><br>Also, number of stations to track length is amazingly linear (duh).<a href=\"https://twitter.com/hashtag/TidyTuesday?src=hash&amp;ref_src=twsrc%5Etfw\">#TidyTuesday</a> <a href=\"https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw\">#rstats</a> <a href=\"https://twitter.com/hashtag/dataviz?src=hash&amp;ref_src=twsrc%5Etfw\">#dataviz</a> <a href=\"https://t.co/pL4eYBIKNE\">pic.twitter.com/pL4eYBIKNE</a></p>&mdash; Rahul (@rsangole) <a href=\"https://twitter.com/rsangole/status/1348416031757242369?ref_src=twsrc%5Etfw\">January 10, 2021</a></blockquote>\n\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(ggrepel)\nlibrary(ggdark)\nlibrary(ggtext)\n\ntransit_cost <- data.table::fread(\"transit_cost.csv\")\n\ntransit_cost <- transit_cost %>%\n  mutate(tunnel_per = as.numeric(str_replace(tunnel_per, \"%\", \"\")),\n         real_cost = as.numeric(real_cost),\n         country = ifelse(is.na(country), \"Unk\", country),\n         cc_id = paste(country,city))\n\ndat <- transit_cost %>%\n  group_by(country, city) %>%\n  summarise(\n    total_projects = n(),\n    total_stations = sum(stations, na.rm = TRUE),\n    total_tunnel_len = sum(tunnel, na.rm = TRUE),\n    total_len = sum(length, na.rm = TRUE),\n    tunnel_pc = total_tunnel_len/total_len,\n    total_cost = sum(real_cost, na.rm = TRUE) / 1e3, #now in Billions\n    avg_stations = mean(stations, na.rm = TRUE),\n    avg_tunnel_len = mean(tunnel, na.rm = TRUE),\n    avg_len = mean(length, na.rm = TRUE),\n    tunnel_pc = avg_tunnel_len/avg_len,\n    avg_cost = mean(real_cost, na.rm = TRUE)\n  ) %>%\n  filter(total_len < 10000,\n         total_projects > 1,\n         country %in% c(\"CN\", \"IN\")) %>%\n  mutate(cc_id = paste(country,city),\n         country = ifelse(country == \"CN\", \"China\", \"India\"))\nglimpse(dat)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 35\nColumns: 13\nGroups: country [2]\n$ country          <chr> \"China\", \"China\", \"China\", \"China\", \"China\", \"China\",…\n$ city             <chr> \"Beijing\", \"Changchun\", \"Changsha\", \"Chengdu\", \"Chong…\n$ total_projects   <int> 27, 7, 13, 11, 11, 7, 3, 10, 5, 11, 10, 8, 2, 5, 12, …\n$ total_stations   <int> 376, 81, 152, 152, 163, 66, 61, 121, 90, 154, 192, 10…\n$ total_tunnel_len <dbl> 450.0686, 95.5000, 164.5400, 225.1000, 156.3370, 151.…\n$ total_len        <dbl> 721.973, 116.000, 216.860, 252.950, 273.220, 166.940,…\n$ tunnel_pc        <dbl> 0.7650659, 0.8232759, 0.8219666, 0.8898992, 0.7867776…\n$ total_cost       <dbl> 138.86373, 16.92127, 38.33016, 44.59756, 41.87035, 25…\n$ avg_stations     <dbl> 13.925926, 11.571429, 11.692308, 13.818182, 14.818182…\n$ avg_tunnel_len   <dbl> 20.45766, 13.64286, 13.71167, 20.46364, 19.54213, 21.…\n$ avg_len          <dbl> 26.73974, 16.57143, 16.68154, 22.99545, 24.83818, 23.…\n$ avg_cost         <dbl> 5143.101, 2417.324, 2948.474, 4054.324, 3806.395, 364…\n$ cc_id            <chr> \"CN Beijing\", \"CN Changchun\", \"CN Changsha\", \"CN Chen…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlabel_dat_india <- dat %>%\n  filter(country %in% \"India\",\n         city != \"Gurgaon\")\nlabel_dat_china <- dat %>%\n  filter(city %in% c(\"Shanghai\", \"Beijing\"))\n\nto_plot <- transit_cost %>%\n  tidyr::drop_na() %>%\n  filter(cc_id %in% dat$cc_id,\n         country %in% c(\"CN\", \"IN\"),\n         length < 100) %>%\n  mutate(country = ifelse(country == \"CN\", \"China\", \"India\"))\n\nglimpse(to_plot)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 192\nColumns: 21\n$ e                <int> 7288, 7289, 7290, 7291, 7296, 7297, 7298, 7299, 7304,…\n$ country          <chr> \"India\", \"India\", \"India\", \"India\", \"India\", \"India\",…\n$ city             <chr> \"Mumbai\", \"Mumbai\", \"Mumbai\", \"Mumbai\", \"Mumbai\", \"Mu…\n$ line             <chr> \"Monorail\", \"Line 3\", \"Line 2A\", \"Line 2B\", \"Line 4\",…\n$ start_year       <chr> \"2009\", \"2016\", \"2016\", \"2018\", \"2018\", \"2019\", \"2017…\n$ end_year         <chr> \"2019\", \"2022\", \"2021\", \"2023\", \"2022\", \"2022\", \"2024…\n$ rr               <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ length           <dbl> 20.20, 33.50, 18.60, 23.50, 32.30, 2.70, 24.90, 14.50…\n$ tunnel_per       <dbl> 0.00, 100.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.0…\n$ tunnel           <dbl> 0.000, 33.500, 0.000, 0.000, 0.000, 0.000, 0.000, 0.0…\n$ stations         <int> 17, 27, 17, 22, 32, 2, 16, 13, 16, 11, 4, 10, 17, 46,…\n$ source1          <chr> \"Plan\", \"Media\", \"Media\", \"Plan\", \"Plan\", \"Plan\", \"Pl…\n$ cost             <dbl> 30000.00, 320000.00, 64100.00, 109860.00, 145490.00, …\n$ currency         <chr> \"INR\", \"INR\", \"INR\", \"INR\", \"INR\", \"INR\", \"INR\", \"INR…\n$ year             <int> 2014, 2019, 2018, 2020, 2020, 2017, 2020, 2016, 2018,…\n$ ppp_rate         <dbl> 0.0540, 0.0470, 0.0480, 0.0470, 0.0470, 0.0480, 0.047…\n$ real_cost        <dbl> 1620.000, 15040.000, 3076.800, 5163.420, 6838.030, 37…\n$ cost_km_millions <dbl> 80.19802, 448.95522, 165.41935, 219.72000, 211.70372,…\n$ source2          <chr> \"Media\", \"Trade\", \"Media\", \"Plan\", \"Plan\", \"Plan\", \"P…\n$ reference        <chr> \"https://indianexpress.com/article/cities/mumbai/indi…\n$ cc_id            <chr> \"IN Mumbai\", \"IN Mumbai\", \"IN Mumbai\", \"IN Mumbai\", \"…\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nin_color <- \"#2a9d8f\"\ncn_color <- \"#fca311\"\n\nchennai <- dat %>% filter(city == \"Chennai\")\nchennai_stations <- chennai$total_stations\nchennai_projects <- chennai$total_projects\nchennai_x <- chennai$avg_len\nchennai_y <- chennai$avg_stations\nchennai_cost <- chennai$total_cost\n\nto_plot %>%\n  ggplot(aes(length, stations)) +\n  geom_point(color = \"#8d99ae\", size = 0.8, show.legend = FALSE, alpha = 0.3) +\n  geom_smooth(data = dat %>% filter(city!=\"Wenzhou\"),\n              aes(avg_len, avg_stations, color = country),\n              se=FALSE, linetype=\"dashed\", size=0.3, method = \"lm\", span = 4) +\n  geom_point(data = dat,\n             aes(avg_len, avg_stations, color = country, size = total_cost^1.3),\n             pch = 19, alpha = 0.7) +\n  geom_text_repel(data = label_dat_india,\n                   aes(avg_len, avg_stations,\n                                   label = city,\n                                   color = country),\n                                   min.segment.length = 1,\n                   box.padding = unit(0.5, \"line\"),\n                   nudge_x = -1,\n                   show.legend = FALSE) +\n  annotate(geom = \"curve\",\n           xend = label_dat_china$avg_len[1], yend = label_dat_china$avg_stations[1],\n           x = label_dat_china$avg_len[1] + 6, y = label_dat_china$avg_stations[1] - 6,\n           curvature = .3, arrow = arrow(length = unit(0, \"mm\")), color = \"#fca311\") +\n  annotate(geom = \"text\",\n           x = label_dat_china$avg_len[1] + 5.5, y = label_dat_china$avg_stations[1] - 7,\n           label = \"Shanghai & Beijing\", hjust = \"left\", size = 3.4, color = \"#fca311\") +\n  annotate(geom = \"curve\",\n           xend = 2, yend = 0,\n           x = 2 + 7, y = 0 - 11,\n           curvature = -.3, arrow = arrow(length = unit(2, \"mm\")), color = \"#8d99ae\", alpha = 0.6) +\n  annotate(geom = \"text\",\n           x = 2 + 7.5, y = 0 - 11.5,\n           label = \"Each point is a transit line\", hjust = \"left\", size = 3.4, color = \"#8d99ae\") +\n  annotate(geom = \"curve\",\n           xend = chennai_x, yend = chennai_y + 2,\n           x = chennai_x, y = chennai_y + 16,\n           curvature = 0, arrow = arrow(length = unit(0, \"mm\")), color = in_color, alpha = 0.6) +\n  annotate(geom = \"text\",\n           x = chennai_x + 0.5, y = chennai_y + 13,\n           label = glue::glue(\n             \"{cost} over {stations} stations\n             in {chennai_projects} lines\",\n             x = scales::label_number(accuracy = 1, suffix = \" km\")(chennai_x),\n             y = chennai_y,\n             stations = chennai_stations,\n             chennai_projects = chennai_projects,\n             cost = scales::label_dollar(accuracy = 1, suffix = \"M\")(chennai_cost)\n             ),\n           hjust = \"left\", size = 3.4, color = in_color) +\n  dark_theme_minimal() +\n  scale_x_continuous(breaks = seq(10, 90, 20)) +\n  scale_y_continuous(breaks = seq(10, 70, 20)) +\n  scale_size(name = \"Total City Cost\",\n             breaks = c(20^1.3, 50^1.3, 80^1.3),\n             labels = c(\"$20M\", \"$50M\",\"$80M\"),\n             range = c(1,10)\n             ) +\n  coord_cartesian(ylim = c(0,90), clip = \"off\") +\n  labs(\n    title = \"The Cost of Transit in the 21<sup>st</sup> Century\",\n    subtitle = glue::glue(\"<span style='color:{cn_color};font-family:Inter-Medium;'>China: </span>253 projects in 28 cities, totaling $1T since 1998<br /><span style='color:{in_color};font-family:Inter-Medium;'>India: </span> 29 projects in 7 cities, totaling $2B since 2011<br /><span style='color:{in_color};font-family:Inter-Medium;'>India</span> has longer transit lines with more stations than <span style='color:{cn_color};font-family:Inter-Medium;'>China</span>, driving up costs <br />for each city.\"),\n    x = \"Average Length\",\n    y = \"Average Stations\",\n    caption = \"#tidytuesday\\n@rsangole\"\n    ) +\n  theme(\n    legend.title = element_text(size = 10, color = \"gray60\"),\n    legend.text =  element_text(size = 10, color = \"gray60\"),\n    axis.ticks.x.bottom = element_line(colour = \"gray30\",size = 0.5),\n    axis.ticks.y.left = element_line(colour = \"gray30\"),\n    axis.title.y = element_text(hjust = .9, size = 10, face = \"italic\", color = \"gray60\"),\n    axis.title.x = element_text(hjust = .9, size = 10, face = \"italic\", color = \"gray60\"),\n    plot.title = element_markdown(family = \"Inter-Medium\", color = \"#f8f8f2\", size = 22,\n                                  margin = margin(0, 0, 0.5, 0, unit = \"line\")),\n    plot.title.position = \"plot\",\n    plot.subtitle = element_markdown(color = \"#f8f8f2\", size = 12, lineheight = 1.2,\n                                     margin = margin(0, 0, 1, 0, unit = \"line\")),\n    plot.margin = margin(1.5, 1.5, 1, 1.5, unit = \"line\"),\n    legend.position = c(0.9,0.1)\n    ) +\n  scale_discrete_manual(aesthetics = \"color\",\n                        values = c(\"India\" = in_color, \"China\" = cn_color),\n                        guide = F)\n```\n\n::: {.cell-output-display}\n![](2021-01-11-tidytuesday-transit-costs_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "2021-01-11-tidytuesday-transit-costs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/twitter-widget-0.0.1/widgets.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}