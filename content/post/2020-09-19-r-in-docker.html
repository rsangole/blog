---
title: R in Docker
author: Rahul S
date: '2020-09-19'
slug: r-in-docker
categories:
  - R
tags:
  - docker
output:
    blogdown::html_page:
        toc: false
---



<div id="pain" class="section level1">
<h1>Pain</h1>
<p>One of the challenges R developers face</p>
</div>
<div id="solution" class="section level1">
<h1>Solution</h1>
<div id="mran-time-machine" class="section level2">
<h2>MRAN Time Machine</h2>
<p>Microsoft R Application Network (MRAN) offers a <a href="https://mran.microsoft.com/timemachine">“time machine”</a>. This service takes a daily snapshot of the <a href="http://cran.r-project.org">CRAN repository</a> repository - going as far back as Sep 2014. You can browse the snapshots on their page:</p>
<p><img src="/post/custom_images/rdocker-mran.png" width="450" />
MRAN snapshots help us lock-down package versions using a ‘date’ as the index. For example, running:</p>
<pre class="r"><code>install.packages(&quot;lattice&quot;, repos = &quot;https://mran.microsoft.com/snapshot/2020-10-01&quot;)</code></pre>
<p>will install the version of <code>{lattice}</code> on 1st Oct, 2020.</p>
<p>Now, this approach doesn’t let you pick and choose <em>specific versions</em> of packages released over time, but instead allows you to lock down a date and get only those versions available on the selected date.</p>
<pre class="r"><code>&gt; options(repos = &quot;https://mran.microsoft.com/snapshot/2020-10-01&quot;)
&gt; getOption(&quot;repos&quot;)
[1] &quot;https://mran.microsoft.com/snapshot/2020-10-01&quot;</code></pre>
</div>
<div id="docker" class="section level2">
<h2>Docker</h2>
<pre class="sh"><code>docker run 
    -d 
    -e PASSWORD=1234 
    -v ~/github/:/home/rstudio/projects/ 
    -p 3838:3838 
    -p 8787:8787 
    hatmatrix/blog:latest</code></pre>
<p>The components of this command are:</p>
<ul>
<li><code>docker run</code> : Run a docker image…</li>
<li><code>-d</code> : in detached mode, i.e. once the image is run in the background, you get your shell prompt back</li>
<li><code>-e PASSWORD=1234</code> : <code>-e</code> are additional arguments. Here, we’ve set the Rstudio password to 1234</li>
<li><code>-v</code> : this maps <code>~/github/</code> on my local machine to <code>~/home/rstudio/projects/</code> within the docker container</li>
<li><code>-p</code> : these args map ports from my local machine to ports within docker. We need one for rstudio (8787) and one for any shiny apps we launch from within rstudio (3838)</li>
<li><code>hatmatrix/blog:latest</code> : this is the name of the docker image</li>
</ul>
<p><strong>The importance of <code>-v</code>:</strong> Without <code>-v</code> you won’t have access to any of your local files within the docker container. Remember, docker containers are fully isolated from your local machine. Also, since containers are ephemeral (i.e. short-lived &amp; temporary), once the container is shutdown, you will lose any data stored within it permanently. Mapping to a local folder allows you to work on projects stored locally within the container.</p>
</div>
<div id="the-dockerfile" class="section level2">
<h2>The Dockerfile</h2>
<p>The <code>Dockerfile</code> holds the definition of how a docker image is built. The <code>Dockerfile</code> I use to create and maintain this blog is saved <a href="LINK_GOES_HERE">here</a>. Here’s a quick explanation of the file:</p>
<pre class="docker"><code>FROM rocker/tidyverse:4.0.0

LABEL maintainer=&quot;Rahul S &lt;rahul.sangole@gmail.com&gt;&quot;</code></pre>
</div>
<div id="using-git" class="section level2">
<h2>Using <code>git</code></h2>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ul>
<li><a href="https://mran.microsoft.com/timemachine" class="uri">https://mran.microsoft.com/timemachine</a></li>
<li><a href="https://github.com/rocker-org/rocker" class="uri">https://github.com/rocker-org/rocker</a></li>
</ul>
</div>
